let customCanvas,correctExprX,correctExprY,lastExprX,lastExprY,highestMagnitudeVector,zoomEnable=0,divByij=1,mulByPx=1,sliderGraphics,sliderValue=1,sliderValueMin=.5,sliderValueMax=2,step=.02,checkboxZoom,sliderGraphicsZoom,sliderValueZoomCurrent=1,sliderValueZoom=1,sliderValueMinZoom=1,sliderValueMaxZoom=8,stepZoom=1,pDenoString,qDenoString,pDenoVal,qDenoval,exprFlag=1,xInput,xInputString,yInput,yInputString,submitBtn,inputVectorFunc,coordDisplay,coordDisplayDiv,xCoord,yCoord,customCoordDiv,displayBoxFlag=0,pOfXy,qOfXy,curlEqu,curlValue,divEqu,divValue,checkbox,checkBoxFlag=0,xAxis=0,yAxis=0,extraDensity=1,pxy,qxy,pDenoString2,qDenoString2,pDenoVal2,qDenoval2,pDx,qDy,pDxVal,qDyVal,divergenceEq,divergenceVal,pDy,qDx,pDyVal,qDxVal,curlEq,curlVal,enableScalingFlag=0,checkboxScale,xyMin,xyMax,currentXY;function setup(){(customCanvas=createCanvas(1300,700)).style("z-index: -100"),customCanvas.position(0,305);let a;translate(width/2,height/2),inputVectorFunc=document.getElementById("input-vector-func"),coordDisplay=document.getElementById("coordinate-disp"),coordDisplayDiv=document.getElementById("coordinate-disp-div"),xCoord=document.getElementById("x-coordinate"),yCoord=document.getElementById("y-coordinate"),customCoordDiv=document.getElementById("custom-coordinate-div"),customCoordDiv.style.display="none",pOfXy=document.getElementById("p-of-xy"),qOfXy=document.getElementById("q-of-xy"),curlEqu=document.getElementById("curl-equation"),curlValue=document.getElementById("curl-value"),divEqu=document.getElementById("divergence-equation"),divValue=document.getElementById("divergence-value"),xInput=document.getElementById("x-input"),xInput.setOptions({virtualKeyboardMode:"manual",virtualKeyboards:"numeric"}),yInput=document.getElementById("y-input"),yInput.setOptions({virtualKeyboardMode:"manual",virtualKeyboards:"numeric"}),submitBtn=document.getElementById("submit-btn"),submitBtn.addEventListener("click",submitButtonPressed),xInputString=nerdamer.convertFromLaTeX(xInput.value).text(),yInputString=nerdamer.convertFromLaTeX(yInput.value).text(),lastExprX=xInputString,lastExprY=yInputString,correctExprX=lastExprX,correctExprY=lastExprY,outerRectangle(),axisLines(),axisLabeling(),highestMagnitudeVector=highestMagnitudeOfVector(),mainVectorFieldPlotter(),colourBarAndMagnitude(highestMagnitudeVector),curl(),divergence(),UIEquation()}function outerRectangle(){colorMode(RGB),stroke(0,0,255),strokeWeight(4),fill(0),rect(-320,-320,640,640)}function axisLines(){colorMode(RGB),stroke("rgba(255,255,255,0.2)"),strokeWeight(3),line(-320,0,320,0),line(0,-320,0,320);for(let a=300;a>= -300;a-=20)line(-320,0+a,320,0+a),line(0+a,-320,0+a,320)}function axisLabeling(){colorMode(HSB),stroke(0,0,0),strokeWeight(1);for(let a=-15;a<16;a++)line(315,20*a+0,325,20*a+0),line(-315,20*a+0,-325,20*a+0),line(20*a+0,-315,20*a+0,-325),line(20*a+0,315,20*a+0,325);let f,e;f=15/divByij/15,e=15/divByij,textSize(12),noStroke(),fill(0);let d=0,b=0;for(textAlign(CENTER,BOTTOM),b=-e;b<=e+1e-5;b+=3*f)(b< -0.000000000000000003&&b> -0.00003||b>3e-18&&b<3e-5)&&(b=0),text(-round(b,3),345,-292+d),text(-round(b,3),-345,-292+d),d+=60;textAlign(CENTER),d=0;for(let c=-e;c<=e+.001;c+=3*f)(c< -0.000000000000000003&&c> -0.00003||c>3e-18&&c<3e-5)&&(c=0),text(-round(c,3),300-d,-330),text(-round(c,3),300-d,345),d+=60;noFill()}function highestMagnitudeOfVector(){let a=0,b=0,f=0,c=0,d,e,g,i,h=[];for(a=-15;a<=15;a++)for(b=-15;b<=15;b++)if(0!==a||0!==b){try{pDenoString=nerdamer(xInputString).denominator().toString(),qDenoString=nerdamer(yInputString).denominator().toString(),pDenoVal=nerdamer(pDenoString,{x:a,y:b}).evaluate().text(),qDenoval=nerdamer(qDenoString,{x:a,y:b}).evaluate().text()}catch(j){lastExprX=correctExprX,lastExprY=correctExprY,runTheCode(),exprFlag=1}if("0"!==pDenoVal&&"0"!==qDenoval){try{d=nerdamer(`simplify(${xInputString})`,{x:a,y:b}).evaluate().text(),e=nerdamer(`simplify(${yInputString})`,{x:a,y:b}).evaluate().text()}catch(k){lastExprX=correctExprX,lastExprY=correctExprY,runTheCode(),exprFlag=1}g=Math.pow(d*d+e*e,.5),h[f]=g,f+=1}}c=h.reduce(function(a,b){return max(a,b)});try{if(isNaN(c))throw 50}catch(l){lastExprX=correctExprX,lastExprY=correctExprY,runTheCode(),exprFlag=1}return c}function mainVectorFieldPlotter(){let a,b,c,d,i,j,p,h,k,g,q,v,r,s,e,f,t,u,w,x,y,l,m,n,o;for(r=15/divByij,s=15/divByij,e=-r;e<=s+.001;e+=1/divByij/extraDensity)for(f=-r;f<=s+.001;f+=1/divByij/extraDensity)if(0!=e||0!=f){try{pDenoString=nerdamer(xInputString).denominator(),qDenoString=nerdamer(yInputString).denominator(),pDenoVal=nerdamer(pDenoString,{x:e,y:f}).evaluate(),qDenoval=nerdamer(qDenoString,{x:e,y:f}).evaluate()}catch(z){lastExprX=correctExprX,lastExprY=correctExprY,runTheCode(),exprFlag=1}if(0!=pDenoVal&&0!=qDenoval){switch(a=e,b=f,p=e*(20*mulByPx),h=f*(20*mulByPx),i=nerdamer(xInputString,{x:e,y:f}).evaluate(),j=nerdamer(yInputString,{x:e,y:f}).evaluate(),v=i*i,t=i/(q=round(sqrt(v+j*j),4)),u=j/q,w=10*t,x=10*u,c=a+t,d=b+u,0==enableScalingFlag&&(k=p+w,g=h+x),1==enableScalingFlag&&(k=p+i*sliderValue,g=h+j*sliderValue),y=(d-b)/(c-a),n=abs(degrees(atan(y))),(c>a&&d>b||c>a&&d==b||c==a&&d>b)&&(o=1),(c<a&&d>b||c<a&&d==b)&&(o=2),c<a&&d<b&&(o=3),(c>a&&d<b||c==a&&d<b)&&(o=4),o){case 4:m=(l=n-135)-90;break;case 3:m=(l=-(n-45))-90;break;case 2:m=(l=n-45)+90;break;case 1:m=(l=90-n+45)+90}h=-h,g=-g,colorMode(HSB,highestMagnitudeVector),stroke(q,highestMagnitudeVector,highestMagnitudeVector),line(p,h,k,g),push(),translate(k,g),rotate(radians(l)),line(0,0,5,0),pop(),push(),translate(k,g),rotate(radians(m)),line(0,0,5,0),pop()}}}function colourBarAndMagnitude(c){let d=c/341,a,b;for(colorMode(HSB,340),b=0;b<=340;b++)stroke(b,340,340),line(380,-320+b,400,-320+b);for(a=0;a<=340;a+=20)textSize(13),textAlign(CENTER,BASELINE),fill(0),noStroke(),textAlign(LEFT),text(round(d*a,4),410,-315+a),noFill(),stroke(0),line(390,-320+a,400,-320+a),noStroke()}function UIEquation(){let a;0==checkBoxFlag&&((checkbox=createCheckbox("Enable Custom Coordinate",!1)).position(customCanvas.x+1130,customCanvas.y+20),checkbox.changed(enableButton),(sliderGraphics=createSlider(sliderValueMin,sliderValueMax,sliderValue,step)).position(customCanvas.x+1025,customCanvas.y+420),sliderGraphics.style("width","220px"),sliderGraphics.attribute("disabled",""),sliderGraphics.input(getSliderValue),(checkboxScale=createCheckbox("Scaling Factor",!1)).position(customCanvas.x+1130,sliderGraphics.y-220),checkboxScale.changed(sliderScale),(xyMin=createInput(sliderValueMin)).position(customCanvas.x+1030,sliderGraphics.y+30),xyMin.size(50,20),xyMin.attribute("disabled",""),xyMin.input(xyMinVal),(xyMax=createInput(sliderValueMax)).position(customCanvas.x+1240,sliderGraphics.y+30),xyMax.size(50,20),xyMax.attribute("disabled",""),xyMax.input(xyMaxVal),(currentXY=createInput(sliderValue)).position(customCanvas.x+1140,sliderGraphics.y+30),currentXY.size(50,20),currentXY.attribute("disabled",""),(checkboxZoom=createCheckbox("Zooming Factor",!1)).position(customCanvas.x+1130,sliderGraphics.y-115),checkboxZoom.changed(sliderScaleZoom),(sliderGraphicsZoom=createSlider(sliderValueMinZoom,sliderValueMaxZoom,sliderValueZoom,stepZoom)).position(customCanvas.x+1025,sliderGraphics.y+110),sliderGraphicsZoom.style("width","220px"),sliderGraphicsZoom.attribute("disabled",""),sliderGraphicsZoom.input(sliderValueZoomRead),(a=createCheckbox("Density++",!1)).position(customCanvas.x+1130,customCanvas.y+110),a.changed(extraDensityEnableFunc),checkBoxFlag=1),displayData()}function extraDensityEnableFunc(){this.checked()?(extraDensity=1.3,runTheCode()):(extraDensity=1,runTheCode())}function sliderScaleZoom(){this.checked()?(sliderGraphicsZoom.removeAttribute("disabled"),zoomEnable=1,runTheCode()):(sliderGraphicsZoom.attribute("disabled",""),divByij=1,mulByPx=1,sliderValueZoom=1,sliderGraphicsZoom.remove(),(sliderGraphicsZoom=createSlider(sliderValueMinZoom,sliderValueMaxZoom,sliderValueZoom,stepZoom)).position(customCanvas.x+1025,sliderGraphics.y+110),sliderGraphicsZoom.style("width","220px"),sliderGraphicsZoom.attribute("disabled",""),sliderGraphicsZoom.input(sliderValueZoomRead),zoomEnable=0,runTheCode())}function sliderValueZoomRead(){divByij=sliderValueZoomCurrent=sliderGraphicsZoom.value(),mulByPx=sliderValueZoomCurrent}function runTheCode(){colorMode(RGB),clear(),colorMode(HSB),outerRectangle(),axisLines(),axisLabeling(),UIEquation(),highestMagnitudeVector=highestMagnitudeOfVector(),mainVectorFieldPlotter(),colourBarAndMagnitude(highestMagnitudeVector)}function submitButtonPressed(){sliderValue=sliderGraphics.value(),xInputString=nerdamer.convertFromLaTeX(xInput.value).text(),yInputString=nerdamer.convertFromLaTeX(yInput.value).text(),lastExprX=xInputString,lastExprY=yInputString,inputVectorFunc.value=`\\vec{F}\\left(x,y\\right)=(${lastExprX})\\hat{i}+(${lastExprY})\\hat{j}`,runTheCode(),1==exprFlag?(correctExprX=lastExprX,correctExprY=lastExprY,mousePressed(),runTheCode()):(lastExprX=correctExprX,lastExprY=correctExprY,mousePressed(),runTheCode(),exprFlag=1),window.scrollTo(0,305)}function mousePressed(){mousePosition(),calculatePQ(),displayData()}function mousePosition(){let c,d,a,b;mouseIsPressed&&(c=mouseX-650,d=-(mouseY-350),a=c/(20*mulByPx),b=d/(20*mulByPx),a>= -15.99/divByij&&a<=15.99/divByij&&b>= -15.99/divByij&&b<=15.99/divByij&&(xAxis=round(a,2),yAxis=round(b,2),0==displayBoxFlag&&(fill("red"),circle(a*(20*mulByPx),-b*(20*mulByPx),8),fill("black"),circle(a*(20*mulByPx),-b*(20*mulByPx),5))))}function calculatePQ(){0==displayBoxFlag&&(pDenoString2=nerdamer(xInputString).denominator().text(),qDenoString2=nerdamer(yInputString).denominator().text(),pDenoVal2=nerdamer(pDenoString,{x:xAxis,y:yAxis}).evaluate(),qDenoval2=nerdamer(qDenoString,{x:xAxis,y:yAxis}).evaluate(),0===pDenoVal2||0===qDenoval2?(pxy="UNDEFINED",qxy="UNDEFINED",divergenceVal="UNDEFINED",curlVal="UNDEFINED"):(pxy=round(nerdamer(xInputString,{x:xAxis,y:yAxis}).evaluate(),3),qxy=round(nerdamer(yInputString,{x:xAxis,y:yAxis}).evaluate(),3),divergence(),curl())),1==displayBoxFlag&&(pDenoString2=nerdamer(xInputString).denominator().text(),qDenoString2=nerdamer(yInputString).denominator().text(),pDenoVal2=nerdamer(pDenoString,{x:xCoord.value,y:yCoord.value}).evaluate(),qDenoval2=nerdamer(qDenoString,{x:xCoord.value,y:yCoord.value}).evaluate(),0===pDenoVal2||0===qDenoval2?(pxy="UNDEFINED",qxy="UNDEFINED",divergenceVal="UNDEFINED",curlVal="UNDEFINED"):(pxy=round(nerdamer(xInputString,{x:xCoord.value,y:yCoord.value}).evaluate(),3),qxy=round(nerdamer(yInputString,{x:xCoord.value,y:yCoord.value}).evaluate(),3),divergence(),curl())),pOfXy.value=`P\\left(x,y\\right)\\hat{i}=${pxy}`,qOfXy.value=`Q\\left(x,y\\right)\\hat{j}=${qxy}`}function divergence(){1==displayBoxFlag&&(pDx=nerdamer.diff(xInputString,"x"),qDy=nerdamer.diff(yInputString,"y"),divergenceEq=nerdamer(pDx+"+"+qDy).toTeX(),divEqu.value=divergenceEq,pDxVal=nerdamer(pDx,{x:xCoord.value,y:yCoord.value}).evaluate(),qDyVal=nerdamer(qDy,{x:xCoord.value,y:yCoord.value}).evaluate(),divergenceVal=round(pDxVal+qDyVal,3),divValue.value=`\\nabla\\cdot\\vec{F}=\\frac{\\partial P}{\\partial x}+\\frac{\\partial Q}{\\partial y}=${divergenceVal}`),0==displayBoxFlag&&(pDx=nerdamer.diff(xInputString,"x"),qDy=nerdamer.diff(yInputString,"y"),divergenceEq=nerdamer(pDx+"+"+qDy).toTeX(),divEqu.value=divergenceEq,pDxVal=round(nerdamer(pDx,{x:xAxis,y:yAxis}).evaluate(),3),qDyVal=round(nerdamer(qDy,{x:xAxis,y:yAxis}).evaluate(),3),divergenceVal=round(pDxVal+qDyVal,3),divValue.value=`\\nabla\\cdot\\vec{F}=\\frac{\\partial P}{\\partial x}+\\frac{\\partial Q}{\\partial y}=${divergenceVal}`)}function curl(){0==displayBoxFlag&&(pDy=nerdamer.diff(xInputString,"y"),qDx=nerdamer.diff(yInputString,"x"),curlEq=nerdamer(qDx+"-"+pDy).toTeX(),pDyVal=round(nerdamer(pDy,{x:xAxis,y:yAxis}).evaluate(),3),qDxVal=round(nerdamer(qDx,{x:xAxis,y:yAxis}).evaluate(),3),curlVal=round(qDxVal-pDyVal,3),curlEqu.value=curlEq,curlValue.value=`\\nabla\\times\\vec{F}=\\frac{\\partial Q}{\\partial x}-\\frac{\\partial P}{\\partial y}=${curlVal}`),1==displayBoxFlag&&(pDy=nerdamer.diff(xInputString,"y"),qDx=nerdamer.diff(yInputString,"x"),curlEq=nerdamer(qDx+"-"+pDy).toTeX(),pDyVal=round(nerdamer(pDy,{x:xCoord.value,y:yCoord.value}).evaluate(),3),qDxVal=round(nerdamer(qDx,{x:xCoord.value,y:yCoord.value}).evaluate(),3),curlVal=round(qDxVal-pDyVal,3),curlEqu.value=curlEq,curlValue.value=`\\nabla\\times\\vec{F}=\\frac{\\partial Q}{\\partial x}-\\frac{\\partial P}{\\partial y}=${curlVal}`)}function displayData(){0==displayBoxFlag&&(coordDisplay.value=`\\left(x,y\\right)=\\left(${xAxis},${yAxis}\\right)`),1==displayBoxFlag&&(coordDisplay.value=`\\left(x,y\\right)=\\left(${xCoord.value},${yCoord.value}\\right)`)}function enableButton(){this.checked()?(xCoord.value=xAxis,yCoord.value=yAxis,displayBoxFlag=1,customCoordDiv.style.display="block",coordDisplayDiv.style.display="none"):(xAxis=xCoord.value,yAxis=yCoord.value,displayBoxFlag=0,customCoordDiv.style.display="none",coordDisplayDiv.style.display="block")}function sliderScale(){this.checked()?(sliderGraphics.removeAttribute("disabled"),xyMax.removeAttribute("disabled"),xyMin.removeAttribute("disabled"),enableScalingFlag=1,runTheCode()):(sliderGraphics.attribute("disabled",""),xyMax.attribute("disabled",""),xyMin.attribute("disabled",""),enableScalingFlag=0,runTheCode())}function sliderScaleDisplay(){sliderGraphics.remove(),(sliderGraphics=createSlider(sliderValueMin,sliderValueMax,sliderValue,step)).position(customCanvas.x+1025,customCanvas.y+420),sliderGraphics.style("width","200px")}function getSliderValue(){currentXY.remove(),(currentXY=createInput(sliderValue=sliderGraphics.value())).position(customCanvas.x+1140,sliderGraphics.y+30),currentXY.size(50,20),currentXY.attribute("disabled","")}function xyMinVal(){sliderValueMin=xyMin.value(),sliderGraphics.remove(),(sliderGraphics=createSlider(sliderValueMin,sliderValueMax,sliderValue,step)).position(customCanvas.x+1025,customCanvas.y+420),sliderGraphics.style("width","220px"),sliderGraphics.input(getSliderValue),currentXY.remove(),(currentXY=createInput(sliderValue=sliderGraphics.value())).position(customCanvas.x+1140,sliderGraphics.y+30),currentXY.size(50,20),currentXY.attribute("disabled","")}function xyMaxVal(){sliderValueMax=xyMax.value(),sliderGraphics.remove(),(sliderGraphics=createSlider(sliderValueMin,sliderValueMax,sliderValue,step)).position(customCanvas.x+1025,customCanvas.y+420),sliderGraphics.style("width","220px"),sliderGraphics.input(getSliderValue),currentXY.remove(),(currentXY=createInput(sliderValue=sliderGraphics.value())).position(customCanvas.x+1140,sliderGraphics.y+30),currentXY.size(50,20),currentXY.attribute("disabled","")}